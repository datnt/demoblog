<a href="javascript:;" id="queryid">Browse all posts</a><br/>
<a href="javascript:;" id="post_newid">Create A new post</a>


<h1>Articles</h1>

<div id="articles">
</div>


<script type="text/javascript">
  function callbackName(){
    //alert('asdf');
  }
  $(document).ready(function(){
    $('#post_newid').click(function(){
      $.ajax({
        url: "http://localhost:3000/api/articles",
        dataType: 'json',
        type : 'POST',
        crossDomain: true,
        jsonpCallback: "callbackName",
        data: {
          access_token: '<%= session[:auth_token] %>',
          name: "name",
          content: 'api'
        },
        beforeSend: function (xhr, settings) {
          xhr.withCredentials = true;
          xhr.setRequestHeader('Authorization', 'Bearer <%= session[:auth_token] %>');
        },
        success: function(data) {
          alert('query xong');
          console.dir(data);
          console.log('a == '+data.article.content);

        }
      });
    });
    $('#queryid').click(function(){
      $.ajax({
        url: "http://localhost:3000/api/articles",
        dataType: 'jsonp',
        type : 'GET',
        crossDomain: true,
        jsonpCallback: "callbackName",
        data: {
          access_token: '<%= session[:auth_token] %>'
        },
        beforeSend: function (xhr, settings) {
          xhr.withCredentials = true;
          xhr.setRequestHeader('Authorization', 'Bearer <%= session[:auth_token] %>');
        },
        success: function(data) {
          $('#articles').html('');
          for (i=0;i<data.articles.length;i++){
            $('#articles').append("<h2>"+data.articles[i].name+"</h2>"+"<div class='content'>"+data.articles[i].content+"</div><div id='comment_"+data.articles[i].id+"'>Comment</div>")
            $('#comment_'+data.articles[i].id).click(function(){
              PostAComment(data.articles[i].id);
            });
          }

        }
      });
    });
    
  });
  function PostAComment(){

  }
</script>